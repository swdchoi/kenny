<div class="container-fluid">

  <% if @payment_terms.any? %>
    <div class="row g-3">
      <% @payment_terms.each do |payment_term| %>

        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-body">

              <div class="d-flex justify-content-between align-items-start">
                <!-- Left content -->
                <div>
                  <h6 class="mb-1 fw-semibold">
                    <%= payment_term.description %>
                  </h6>
                  <small class="text-muted">
                      <%= payment_term.amount %>$ 
                  </small>
                  <% if payment_term.percentage.present? %>
                    <small class="text-muted">
                      (<%= payment_term.percentage %>% of contract)
                    </small>
                  <% end %>

                  <% case payment_term.status %>
                  <% when "pending" %>
                    <span class="badge rounded-pill bg-secondary">Pending</span>

                  <% when "due" %>
                    <span class="badge rounded-pill bg-warning text-dark">Due</span>

                  <% when "invoiced" %>
                    <span class="badge rounded-pill bg-info text-dark">Invoiced</span>

                  <% when "completed" %>
                    <span class="badge rounded-pill bg-success">Completed</span>
                  <% end %>
                </div>

                <!-- Amount -->
                <div class="text-end">
                  <div class="fw-semibold fs-5">
                    $<%= number_with_precision(payment_term.amount, precision: 2) %>
                  </div>
                  <small class="text-muted">
                    Target: <%= payment_term.target_date %>
                  </small>
                </div>
              </div>

              <hr class="my-3">

              <!-- Invoice status -->
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <% if payment_term.invoice.present? %>
                    <% status = payment_term.invoice.derived_status %>

                    <span class="badge rounded-pill bg-<%= {
                      "draft"   => "secondary",
                      "issued"  => "warning",
                      "paid"    => "success",
                      "overdue" => "danger"
                    }[status] %>">
                      <%= status.titleize %>
                    </span>

                    <small class="text-muted ms-2">
                      Due <%= payment_term.invoice.due_date %>
                    </small>
                  <% else %>
                    <span class="text-muted">Invoice not issued</span>
                  <% end %>
                </div>

                <!-- Actions -->
                <div class="d-flex gap-2">
                  <% if payment_term.invoice.present? %>
                    <%= link_to "Edit Invoice",
                        edit_invoice_path(payment_term.invoice),
                        class: "btn btn-sm btn-outline-secondary" %>

                    <%= button_to "Delete Invoice",
                        invoice_path(payment_term.invoice),
                        method: :delete,
                        data: { confirm: "Delete invoice?" },
                        form: { class: "d-inline" },
                        class: "btn btn-sm btn-outline-danger" %>
                  <% else %>
                    <%= link_to "Issue Invoice",
                        new_payment_term_invoice_path(payment_term),
                        class: "btn btn-sm btn-outline-primary" %>
                  <% end %>

                  <%= link_to "Edit",
                      edit_payment_term_path(payment_term, contract_id: payment_term.contract.id),
                      class: "btn btn-sm btn-outline-secondary" %>

                  <%= button_to "Delete",
                      payment_term_path(payment_term),
                      method: :delete,
                      data: { confirm: "Delete payment term?" },
                      form: { class: "d-inline" },
                      class: "btn btn-sm btn-outline-danger" %>
                </div>
              </div>

            </div>
          </div>
        </div>

      <% end %>
    </div>
  <% else %>
    <p class="text-muted text-center py-4">
      No payment terms added yet.
    </p>
  <% end %>

</div>